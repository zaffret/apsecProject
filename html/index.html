<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Page</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css"
      integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css"
      integrity="sha512-dPXYcDub/aeb08c63jRq/k6GaKccl256JQy/AnOq7CAnEZ9FzSL9wSbcZkMp4R26vBsMLFYH4kQ67/bbV8XaCQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      .form-label {
        font-weight: 500;
      }
      .validation {
        display: none;
        font-size: 0.85em;
      }
      .valid {
        color: green;
        display: block;
      }
      .invalid {
        color: red;
        display: block;
      }
      .valid .bi-x-circle-fill,
      .invalid .bi-check-circle-fill {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="text-center mt-5 mb-4 fw-bold fs-3">
        <span>Register</span>
      </div>
      <div class="row justify-content-center">
        <div class="col-lg-5">
          <form
            id="registerForm"
            style="
              border: 2px solid rgba(0, 0, 0, 0.281);
              padding: 10px;
              border-radius: 10px;
              box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            "
          >
            <label for="uname" class="form-label mt-2 fw-semibold">Name</label>
            <input
              id="uname"
              type="text"
              class="form-control mb-3"
              name="uname"
              placeholder="Enter Name"
              required
            />
            <label for="email" class="form-label fw-semibold">Email</label>
            <input
              id="email"
              type="email"
              class="form-control mb-3"
              name="email"
              placeholder="Enter Email "
              required
            />
            <div id="emailCheck" class="validation ms-1">
              <div id="validEmail" class="invalid">
                <i class="bi bi-check-circle-fill"></i
                ><i class="bi bi-x-circle-fill"></i> Contains name, @, and
                domain (eg. a@b.com)
              </div>
            </div>

            <label for="psw" class="form-label fw-semibold">Password</label>
            <div class="input-group mb-1">
              <input
                id="psw"
                type="password"
                autocomplete="password"
                class="form-control"
                name="psw"
                placeholder="Set Password"
                required
              />
              <span class="input-group-text" id="togglePassword">
                <i class="bi bi-eye"></i>
              </span>
            </div>
            <div id="passwordCheck" class="validation ms-1 d-">
              <div id="minLength" class="invalid">
                <i class="bi bi-check-circle-fill"></i
                ><i class="bi bi-x-circle-fill"></i> At least 8 characters
              </div>

              <div id="lowercase" class="invalid">
                <i class="bi bi-check-circle-fill"></i
                ><i class="bi bi-x-circle-fill"></i> At least one lowercase
                letter
              </div>

              <div id="uppercase" class="invalid">
                <i class="bi bi-check-circle-fill"></i
                ><i class="bi bi-x-circle-fill"></i> At least one uppercase
                letter
              </div>

              <div id="number" class="invalid">
                <i class="bi bi-check-circle-fill"></i
                ><i class="bi bi-x-circle-fill"></i> At least one number
              </div>

              <div id="specialChar" class="invalid">
                <i class="bi bi-check-circle-fill"></i
                ><i class="bi bi-x-circle-fill"></i> At least one special
                character (eg. !@#$%^&*())
              </div>

              <div id="noSpaces" class="invalid">
                <i class="bi bi-check-circle-fill"></i
                ><i class="bi bi-x-circle-fill"></i> No spaces
              </div>
            </div>
            <label for="role" class="form-label fw-semibold mt-3">Role</label>
            <select name="role" id="role" class="form-select mb-3">
              <option value="user">User</option>
              <option value="member">Member</option>
              <option value="creator">Creator</option>
              <option value="admin">Admin</option>
            </select>
            <div class="text-center mb-2">
              <button type="submit" class="btn btn-danger w-100">
                Register
              </button>
            </div>
            <div class="text-center" style="font-size: 0.85em">
              <span
                >Already have an account? <a href="login.html">Login</a></span
              >
            </div>
          </form>
          <div class="text ms-1 mt-1" style="font-size: 0.9em">
            <span id="error" class="text-danger"></span>
          </div>
        </div>
      </div>
    </div>
    <script>
      const togglePassword = document.querySelector("#togglePassword");
      const password = document.querySelector("#psw");

      togglePassword.addEventListener("click", function () {
        const type =
          password.getAttribute("type") === "password" ? "text" : "password";
        password.setAttribute("type", type);

        this.querySelector("i").classList.toggle("bi-eye");
        this.querySelector("i").classList.toggle("bi-eye-slash");
      });

      const passwordValidation = document.getElementById("passwordCheck");

      const validationRules = [
        {
          element: document.getElementById("minLength"),
          test: (value) => value.length >= 8,
        },
        {
          element: document.getElementById("lowercase"),
          test: (value) => /[a-z]/.test(value),
        },

        {
          element: document.getElementById("uppercase"),
          test: (value) => /[A-Z]/.test(value),
        },
        {
          element: document.getElementById("number"),
          test: (value) => /\d/.test(value),
        },
        {
          element: document.getElementById("specialChar"),
          test: (value) => /[^A-Za-z0-9]/.test(value),
        },
        {
          element: document.getElementById("noSpaces"),
          test: (value) => !/\s/.test(value),
        },
      ];

      function validatePassword() {
        const pswValue = password.value;

        validationRules.forEach((rule) => {
          if (rule.test(pswValue)) {
            rule.element.classList.add("valid");
            rule.element.classList.remove("invalid");
          } else {
            rule.element.classList.add("invalid");
            rule.element.classList.remove("valid");
          }
        });
      }

      password.addEventListener("input", function () {
        passwordValidation.style.display = "block";

        if (!password.value) {
          passwordValidation.style.display = "none";
        }
        validatePassword();
      });

      // New code for email validation
      const emailInput = document.getElementById("email");
      const emailValidation = document.getElementById("emailCheck");
      const emailRule = {
        element: document.getElementById("validEmail"),
        test: (value) =>
          /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(value),
      };

      function validateEmail() {
        const emailValue = emailInput.value;
        if (emailRule.test(emailValue)) {
          emailRule.element.classList.add("valid");
          emailRule.element.classList.remove("invalid");
        } else {
          emailRule.element.classList.add("invalid");
          emailRule.element.classList.remove("valid");
        }
      }

      emailInput.addEventListener("input", function () {
        emailValidation.style.display = "block";
        if (!emailInput.value) {
          emailValidation.style.display = "none";
        }
        validateEmail();
      });

      // Intercept form submission
      function processForm(event) {
        event.preventDefault();
        const uname = document.getElementById("uname");
        const psw = document.getElementById("psw");
        const email = document.getElementById("email");
        const role = document.getElementById("role").value;
        var data = JSON.stringify({
          name: uname.value,
          password: psw.value,
          email: email.value,
        });
        var xhr = new XMLHttpRequest();
        xhr.addEventListener("readystatechange", function () {
          if (this.readyState === 4) {
            console.log(this.responseText);
            var response = JSON.parse(this.responseText);

            if (this.status >= 200 && this.status < 300) {
              alert(response.message);
              window.location.href = "login.html";
            } else {
              document.getElementById("error").innerText = response.message;
            }
          }
        });
        xhr.open("POST", "https://thuhtet.com/" + role + "-register");
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.send(data);
      }
      const form = document.getElementById("registerForm");
      form.addEventListener("submit", processForm);

      const inputs = document.querySelectorAll(".form-control");
      inputs.forEach((input) => {
        input.addEventListener("focus", function () {
          const errorSpan = document.getElementById("error");
          errorSpan.innerText = "";
        });
      });
    </script>
  </body>
</html>
